<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Brisk n' Brew Cafe</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="dashboard.css">
  <link rel="icon" href="images/logo.jpeg">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
  <!-- Logo -->
  <div class="logo">
    <img src="https://scontent.fmnl2-2.fna.fbcdn.net/v/t39.30808-1/490890075_666237659327174_1028809354707116774_n.jpg?stp=dst-jpg_s160x160_tt6&_nc_cat=107&ccb=1-7&_nc_sid=2d3e12&_nc_eui2=AeGzVXQaRPMOp2UCTqzL6fFTWRI5oqdaIhVZEjmip1oiFaQB_Tqst7DC75TmhAYlsAvyMdOAfpyrabsRAC4VWnd6&_nc_ohc=WN7QPtwrFXQQ7kNvwGmolxc&_nc_oc=AdndZICVxLWSVi4uVj0oIw-9rxiYpVOUjP0tEPnshTOYBMBY9pacJUFoEINPdcrAk9TzJ7LtVqRivWDF57dw_MaL&_nc_zt=24&_nc_ht=scontent.fmnl2-2.fna&_nc_gid=TYP4oe0fwOQjLwwCiSewVg&oh=00_AfXq2MgJVKL5KbLVl4T5rAHDKPFI5B5QI4Xy3-4pzKa5wg&oe=68AB106C"
      alt="Cafe Logo">
  </div>

  <!-- Welcome -->
  <div class="welcome">
    <p class="heading">Welcome To</p>   
    <h1 class="cafe-name">Brisk n' Brew Cafe</h1>
    <p class="slogan">bigger place with bigger taste</p>
  </div>

  <!-- Menu Items -->
   <div class="menu-items-grid">
        <div class="menu-item-card" style="animation-delay: 1.0s;">
            <img src="https://scontent.fmnl2-2.fna.fbcdn.net/v/t39.30808-6/518272906_729509746333298_1898317216412684499_n.jpg?_nc_cat=103&ccb=1-7&_nc_sid=833d8c&_nc_eui2=AeFTGr1_CAeRYDrTjm8ItuegzX5MPqAZCO_Nfkw-oBkI7zTDP-cpsoA-A440Ym5I8LZkiUmWpuQD3LQyjRDlSWO-&_nc_ohc=nfOVuU0TSqMQ7kNvwFKPyCk&_nc_oc=Adku0IUqbUieGz-RQeflfML5vD28jt9q3U4sRtZch4Ln_Cby2llhWxyPQMkjp_X5yHoTu-B1pgn26O2uoIye9yT_&_nc_zt=23&_nc_ht=scontent.fmnl2-2.fna&_nc_gid=ZVJ-pdkQGxQOArzMo3SNtg&oh=00_AfUtws263tKvI0Ii7gUYta6XdhWgYFiFqLBnm68VaYk_zg&oe=68AB17E3" alt="Iced Dark Choco">
            <p>ICED DARK CHOCO</p>
        </div>
        <div class="menu-item-card" style="animation-delay: 1.2s;">
            <img src="https://scontent.fmnl2-2.fna.fbcdn.net/v/t39.30808-6/515437071_729510486333224_8972985370916922905_n.jpg?_nc_cat=111&ccb=1-7&_nc_sid=833d8c&_nc_eui2=AeFrYbMByekk_YXCV1NEGIqQloGcR7gJMHaWgZxHuAkwdhV1vCaLAydgxegZftVFx2iIzQsxhP1UwUdwSrVeUYCz&_nc_ohc=AiNCTuMnte4Q7kNvwGSjtI6&_nc_oc=AdkAbWeoIYc_cogUikYH93S4tK4BiYY17pIu6P9bPKT3BXH_m0yZoiKkki-lASxlLWmT_tJqfcvbHEKDgEWcw9WQ&_nc_zt=23&_nc_ht=scontent.fmnl2-2.fna&_nc_gid=K_Oeo9OVfrE3un1aam7UwA&oh=00_AfV5LTajtKzYMSGg3hDXnnrF5iq-OHaM7P8cJRseG89Ybg&oe=68AB06F4" alt="Ice Cream Fudge Frappe">
            <p>ICE CREAM FUDGE FRAPPE</p>
        </div>
        <div class="menu-item-card" style="animation-delay: 1.4s;">
            <img src="https://scontent.fmnl2-2.fna.fbcdn.net/v/t39.30808-6/515438150_729510659666540_2823164081641806021_n.jpg?_nc_cat=100&ccb=1-7&_nc_sid=833d8c&_nc_eui2=AeEfG6ly4t0nzrgRiVaBH5tsLIJzL3byH5wsgnMvdvIfnAgYGpFJjlzFIgD1GugZjatcQlTHK3TmHDGAA8Dngrbk&_nc_ohc=V4tqRJi9Dp4Q7kNvwHTXxUH&_nc_oc=AdkOrG1qq31wWXYN2Pq9-WVOf9ww98ZgxRTmbfqrZL-y-7fqb20e48GFGRY_kM7RKa57YTH6fzufuLSh6RLiJZAc&_nc_zt=23&_nc_ht=scontent.fmnl2-2.fna&_nc_gid=c81ft2ER7xlgyNkowe2pYw&oh=00_AfW5qEjnBUfU1mHWaU-XyctgcO9LMZZrtOgJdjASfbrR2Q&oe=68AB154C" alt="NUTELLA MUDSLIDE">
            <p>NUTELLA MUDSLIDE</p>
        </div>
        
        <div class="menu-item-card" style="animation-delay: 1.6s;">
            <img src="https://scontent.fmnl2-2.fna.fbcdn.net/v/t39.30808-6/516742387_729510306333242_3924372553420028305_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=833d8c&_nc_eui2=AeELWbYEMS7bxmCGm6KCy7SM0vmJMKrLKJHS-YkwqssokbLtbZuLXapO282_QZeySxxHxHN1Nl3M6FkYD8rwXS64&_nc_ohc=nmimDfhBi9wQ7kNvwGKSW8h&_nc_oc=AdkNYxTN4Kh3ElpkXuz_ZYGqlD5-yRJYiwI4TdWO-X56Tsw5N4OuJsAe_mBvonTHQE-UD5e-_h0TtaBtNV2-UuGp&_nc_zt=23&_nc_ht=scontent.fmnl2-2.fna&_nc_gid=Wnqx5LvSplQ0zVmKQZMXaw&oh=00_AfUGvC5-4mkfHk-6NIwZm2ioYK_O7sJleK8BGIry15xHyA&oe=68AB060C" alt="Chicken in Mushroom">
            <p>CHICKEN IN MUSHROOM</p>
        </div>
        <div class="menu-item-card" style="animation-delay: 1.8s;">
            <img src="https://scontent.fmnl2-2.fna.fbcdn.net/v/t39.30808-6/518273621_729509812999958_3717379645935914730_n.jpg?_nc_cat=107&ccb=1-7&_nc_sid=833d8c&_nc_eui2=AeGRV83yyLxhXr78N9rRFN23TNjqIZcTY39M2OohlxNjf3j--5c01INPOdi1Ahqvz_aLwSLEZAloON9FQHzptHZX&_nc_ohc=hdhUhL9LRQEQ7kNvwGaq5IH&_nc_oc=Adlz7usBmJe5qcJDUd64iHpGy1JxV71tVPpdF7bYbDJTOqj_jjvflfYPTmLz-Q82lJA53MS8ECTrTBUwQMwrqn19&_nc_zt=23&_nc_ht=scontent.fmnl2-2.fna&_nc_gid=-g9my7Yb2j1I0B5ToEz6uA&oh=00_AfXY-3ileWjOUAJuT8bNmlnJsMwrRsR03BuIG-saFMmwww&oe=68AAE9BB" alt="BARKADA PLATTER">
            <p>BARKADA PLATTER</p>
        </div>
        <div class="menu-item-card" style="animation-delay: 2.0s;">
            <img src="https://scontent.fmnl2-2.fna.fbcdn.net/v/t39.30808-6/515438014_729510449666561_7351567771019700104_n.jpg?_nc_cat=110&ccb=1-7&_nc_sid=833d8c&_nc_eui2=AeG41i3FERQVYmt2lHwl6cpv_YarAwt-g1H9hqsDC36DURQztI6F8emDPHZ2Q-WiD3KLKO1dqUyR1rcGkEE0e40v&_nc_ohc=TrlRA8RRGS4Q7kNvwFXwNhd&_nc_oc=AdnDelxJoHDvTquSUAA5PQoKtd5kfRVL2cld3B3U4jaitiOl8mSGs0KYv-ujIQhBh0t0syBdhS_21dVyll7LC3gb&_nc_zt=23&_nc_ht=scontent.fmnl2-2.fna&_nc_gid=4WQ1unxW-ggIDnmP5qCGaA&oh=00_AfUyVCncyGMSlso8IuAf6_eNmUcta15HbpMffH_jdT9qJA&oe=68AAFE4E" alt="Clubhouse Sandwich">
            <p>CLUBHOUSE SANDWICH</p>
        </div>
      </div>

  <!-- Header -->
  <div class="user-dashboard-header">
    <span class="username-display" id="displayedUsername">Welcome, User!</span>
    <div class="hamburger-icon" id="navToggle"><span></span><span></span><span></span></div>
    <div class="order-now-bubble" id="orderNowBubble" style="animation-delay: 1.0s;">Order Now!</div>
  </div>

  <!-- Navigation -->
  <nav class="dashboard-nav" id="dashboardNav">
    <ul>
      <li><a href="food.html">Food</a></li>
      <li><a href="beverage.html">Beverage</a></li>
      <li><a href="ReservTT.html">Reservation</a></li>
      <li><a href="#">Order History</a></li>
      <li><a href="ui.html" class="logout-link" id="logoutBtn">Log Out</a></li>
    </ul>
    <div class="customer-info" id="customerInfo">
      <p><strong>Mobile:</strong> -</p>
      <p><strong>Address:</strong> -</p>
      <p><strong>Description:</strong> -</p>
    </div>
  </nav>

  <!-- Order Info Modal -->
  <div class="modal" id="orderModal">
    <div class="modal-content"> 
      <span class="close-btn" id="closeModal">&times;</span>
      <h2>Enter Delivery Details</h2>

      <form id="orderForm" class="order-form">
        <h2 class="form-title">Customer Information</h2>

        <label for="mobile">üì± Mobile:</label>
        <input type="text" id="mobile" required placeholder="Enter your mobile number">

        <label for="address">üìç Address:</label>
        <input type="text" id="address" required placeholder="Enter your delivery address">

        <label for="addressDesc">üìù Address Description:</label>
        <input type="text" id="addressDesc" placeholder="e.g. Near Barangay Hall">

        <label for="distance">üöó Distance (km):</label>
        <input type="text" id="distance" readonly placeholder="Auto-calculated">

        <div class="reminder-box">
          <strong>‚òï Friendly Reminder from Brisk n Brew:</strong><br>
          To ensure the best quality of our products, some items like beverages may not be available for delivery to locations more than <b>5 kilometers</b> from our store.<br>
          <em>Thank you for your understanding and support!</em>
        </div>

        <button type="submit" class="submit-btn">Proceed</button>
      </form>

      <!-- üìç Map container -->
      <div id="map" style="height:300px; margin-top:15px; border-radius:10px;"></div>
    </div>
  </div>

  <!-- Social Icons -->
  <div class="social-logos">
    <a href="https://www.facebook.com/bakeandbrew.manila" target="_blank">
      <img src="https://upload.wikimedia.org/wikipedia/commons/c/cd/Facebook_logo_%28square%29.png" alt="Facebook Logo">
    </a>
    <a href="https://www.instagram.com/brisknbrew.manila?igsh=NDltOGJjMjU3MHVz" target="_blank">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS8lv-iEOWtRxGDqsOR-Pa1kIiqN298569zVA&s" alt="Instagram Logo">
    </a>
    <a href="https://www.tiktok.com/@brisknbrew?is_from_webapp=1&sender_device=pc" target="_blank">
      <img src="https://static.vecteezy.com/system/resources/previews/006/057/996/non_2x/tiktok-logo-on-transparent-background-free-vector.jpg" alt="TikTok Logo">
    </a>
  </div>

  <div class="background-image"></div>

  <!-- Turf.js -->
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- Your existing scripts (untouched) -->
  <script>
    const foodLink = document.querySelector('a[href="food.html"]');
    const beverageLink = document.querySelector('a[href="beverage.html"]');
    const modal = document.getElementById('orderModal');
    const closeModal = document.getElementById('closeModal');
    const orderForm = document.getElementById('orderForm');
    const customerInfo = document.getElementById('customerInfo');
    let selectedPage = "";

    [foodLink, beverageLink].forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault(); 
        selectedPage = this.getAttribute("href");
        modal.style.display = 'flex';
      });
    });

    closeModal.addEventListener('click', () => modal.style.display = 'none');
    window.addEventListener('click', (e) => { if (e.target === modal) modal.style.display = 'none'; });

    function updateCustomerInfo() {
      const saved = JSON.parse(localStorage.getItem("customerInfo"));
      if (saved) {
        customerInfo.innerHTML = `
          <p><strong>Mobile:</strong> ${saved.mobile}</p>
          <p><strong>Address:</strong> ${saved.address}</p>
          <p><strong>Description:</strong> ${saved.desc}</p>
          <p><strong>Distance:</strong> ${saved.distance} km</p>
        `;
      }
    }
  </script>

  <!-- üöÄ NEW Map + Distance logic -->
  <script>
    const storeLocation = [120.9944, 14.5776]; // lng, lat
    let map, storeMarker, customerMarker, routeLine;

    function initMap() {
      map = L.map('map').setView([14.5776, 120.9944], 13);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '¬© OpenStreetMap'
      }).addTo(map);

      storeMarker = L.marker([14.5776, 120.9944]).addTo(map)
        .bindPopup("üè™ Brisk n' Brew Cafe")
        .openPopup();
    }

    function showOnMap(lat, lon) {
      if (!map) initMap();
      if (customerMarker) map.removeLayer(customerMarker);
      if (routeLine) map.removeLayer(routeLine);

      customerMarker = L.marker([lat, lon]).addTo(map)
        .bindPopup("üìç Your Location")
        .openPopup();

      routeLine = L.polyline([[14.5776, 120.9944], [lat, lon]], {color: 'blue'}).addTo(map);
      map.fitBounds(routeLine.getBounds(), {padding: [50, 50]});
    }

    async function getCoordinates(address) {
      const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`;
      const response = await fetch(url);
      const data = await response.json();
      if (data.length > 0) return [parseFloat(data[0].lon), parseFloat(data[0].lat)];
      return null;
    }

    async function checkDistance(address) {
      const coords = await getCoordinates(address);
      if (!coords) return null;
      const from = turf.point(storeLocation);
      const to = turf.point(coords);
      const options = { units: 'kilometers' };
      return turf.distance(from, to, options).toFixed(2);
    }

    orderForm.addEventListener("submit", async function(e) {
      e.preventDefault();
      const mobile = document.getElementById("mobile").value;
      const address = document.getElementById("address").value;
      const desc = document.getElementById("addressDesc").value;

      const coords = await getCoordinates(address);
      if (!coords) {
        alert("‚ùå Unable to find location.");
        return;
      }

      const distance = await checkDistance(address);
      if (!distance) return;
      document.getElementById("distance").value = distance;

      const customer = { mobile, address, desc, distance };
      localStorage.setItem("customerInfo", JSON.stringify(customer));
      updateCustomerInfo();

      // Show map
      showOnMap(coords[1], coords[0]); // lat, lon

      if (selectedPage.includes("beverage") && distance > 5) {
        alert("‚ö†Ô∏è Beverages cannot be delivered beyond 5 km.");
        modal.style.display = 'none';
        return;
      }

      window.location.href = selectedPage;
    });

    document.addEventListener("DOMContentLoaded", updateCustomerInfo);
  </script>
  <script>
        const navToggle = document.getElementById('navToggle');
        const dashboardNav = document.getElementById('dashboardNav');
        const logoutBtn = document.getElementById('logoutBtn');
        const displayedUsername = document.getElementById('displayedUsername');

        // Toggle Nav
        function closeNav() {
            dashboardNav.classList.remove('active');
            navToggle.classList.remove('active');
        }

        navToggle.addEventListener('click', function(event) {
            event.stopPropagation();
            dashboardNav.classList.toggle('active');
            this.classList.toggle('active');
        });

        // Close Nav when clicking outside
        document.addEventListener('click', function(event) {
            if (!navToggle.contains(event.target) && !dashboardNav.contains(event.target)) {
                closeNav();
            }
        });

        // Logout Logic
        logoutBtn.addEventListener('click', function(event) {
            event.preventDefault();
            const confirmLogout = confirm("Are you sure you want to log out?");
            if (confirmLogout) {
                localStorage.removeItem('loggedInUser');
                window.location.href = "ui.html";
            }
        });

        // Close nav if a menu item inside it is clicked (and it's not the logout button)
        dashboardNav.querySelectorAll('ul li a:not(#logoutBtn)').forEach(item => {
            item.addEventListener('click', closeNav);
        });

        // Show username
        document.addEventListener('DOMContentLoaded', () => {
            const user = JSON.parse(localStorage.getItem('loggedInUser'));
            if (user && user.username) {
                const formattedUsername = user.username
                    .split(' ')
                    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                    .join(' ');
                displayedUsername.textContent = `Welcome, ${formattedUsername}!`;
            } else {
                window.location.href = "login.html";
            }
        });
    </script>
    <script>const orderNowBubble = document.getElementById('orderNowBubble');

// Hide when nav opens
navToggle.addEventListener('click', () => {
    if (dashboardNav.classList.contains('active')) {
        // If nav is open, hide the bubble
        orderNowBubble.style.display = "none";
    } else {
        // If nav is being closed by the toggle button
        orderNowBubble.style.display = "block";
    }
});

// Close nav when clicking outside (already in your code)
document.addEventListener('click', function(event) {
    if (!navToggle.contains(event.target) && !dashboardNav.contains(event.target)) {
        closeNav(); // existing function
        orderNowBubble.style.display = "block"; // show bubble again
    }
});

// Hide bubble when clicking nav links
dashboardNav.querySelectorAll('ul li a:not(#logoutBtn)').forEach(item => {
    item.addEventListener('click', () => {
        closeNav();
        orderNowBubble.style.display = "block"; // show again after closing
    });
});
</script>
</body>
</html>
